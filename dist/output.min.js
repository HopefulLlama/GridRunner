var PRS$0=function(a,b){return a.__proto__={a:b},a.a===b}({},{}),DP$0=Object.defineProperty,GOPD$0=Object.getOwnPropertyDescriptor,MIXIN$0=function(a,b){for(var c in b)b.hasOwnProperty(c)&&DP$0(a,c,GOPD$0(b,c));return a},GridRunnerUtil=function(){"use strict";function a(){}DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1});var b={};return b.random=function(a,b){return Math.floor(Math.random()*(b+1-a)+a)},b.randomElement=function(b){return b[a.random(0,b.length-1)]},MIXIN$0(a,b),b=void 0,a}(),RunnerPosition=function(){"use strict";function a(a,b){this.x=a,this.y=b}return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}(),RunnerColour=function(){"use strict";function a(a,b,c){this.r=a,this.g=b,this.b=c}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.getRgb=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},b.getRgba=function(a){return"rgba("+this.r+", "+this.g+", "+this.b+", "+(a?a:1)+")"},MIXIN$0(a.prototype,b),b=void 0,a}(),RunnerColourManager=function(){"use strict";function a(a,b){if(a?this.colours=[]:this.colours=[new RunnerColour(255,0,0),new RunnerColour(0,255,0),new RunnerColour(0,0,255),new RunnerColour(255,0,255),new RunnerColour(255,255,0),new RunnerColour(0,255,255)],Array.isArray(b)){var c=b.filter(function(a){return RunnerColour.prototype.isPrototypeOf(a)});c.length!==b.length&&console.log("Error adding colours: Some colours have incorrect prototype."),this.colours=this.colours.concat(c)}else console.log("Error adding colours: Not an array.")}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.getRandomColour=function(){return GridRunnerUtil.randomElement(this.colours)},MIXIN$0(a.prototype,b),b=void 0,a}(),RunnerBehaviour=function(){"use strict";function a(a,b,c,d,e){this.incrementPosition=a,this.getStartingPosition=b,this.isFinished=c,this.draw=d,this.drawTrail=e}return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}(),RunnerBehaviourManager=function(){"use strict";function a(a,b){if(a?this.behaviours=[]:this.behaviours=[new RunnerBehaviour(function(a,b,c){return new RunnerPosition(a.position.x-b.speed/c,a.position.y)},function(a,b){var c=(Math.floor(a.width/b.size),Math.floor(a.height/b.size));return new RunnerPosition(a.width+100,b.size*GridRunnerUtil.random(0,c))},function(a,b,c){return b.position.x<0-c.size-c.trailLength},function(a,b,c){a.fillStyle=b.colour.getRgb(),a.strokeStyle=b.colour.getRgb(),a.fillRect(b.position.x-c.size,b.position.y-c.size,2*c.size,2*c.size)},function(a,b,c){for(var d=100*c.initialTrailOpacity,e=c.trailLength/d,f=0;f<d;f++)a.fillStyle=b.colour.getRgba((d-f)/100),a.strokeStyle=b.colour.getRgba((d-f)/100),a.fillRect(b.position.x+c.size+f*e,b.position.y-c.size,e,2*c.size)}),new RunnerBehaviour(function(a,b,c){return new RunnerPosition(a.position.x,a.position.y-b.speed/c)},function(a,b){var c=Math.floor(a.width/b.size);Math.floor(a.height/b.size);return new RunnerPosition(b.size*GridRunnerUtil.random(0,c),a.height+100)},function(a,b,c){return b.position.y<0-c.size-c.trailLength},function(a,b,c){a.fillStyle=b.colour.getRgb(),a.strokeStyle=b.colour.getRgb(),a.fillRect(b.position.x-c.size,b.position.y-c.size,2*c.size,2*c.size)},function(a,b,c){for(var d=100*c.initialTrailOpacity,e=c.trailLength/d,f=0;f<d;f++)a.fillStyle=b.colour.getRgba((d-f)/100),a.strokeStyle=b.colour.getRgba((d-f)/100),a.fillRect(b.position.x-c.size,b.position.y+c.size+f*e,2*c.size,e)}),new RunnerBehaviour(function(a,b,c){return new RunnerPosition(a.position.x+b.speed/c,a.position.y)},function(a,b){var c=(Math.floor(a.width/b.size),Math.floor(a.height/b.size));return new RunnerPosition(-100,b.size*GridRunnerUtil.random(0,c))},function(a,b,c){return b.position.x>a.width+2*c.size+c.trailLength},function(a,b,c){a.fillStyle=b.colour.getRgb(),a.strokeStyle=b.colour.getRgb(),a.fillRect(b.position.x-c.size,b.position.y-c.size,2*c.size,2*c.size)},function(a,b,c){for(var d=100*c.initialTrailOpacity,e=c.trailLength/d,f=0;f<d;f++)a.fillStyle=b.colour.getRgba((d-f)/100),a.strokeStyle=b.colour.getRgba((d-f)/100),a.fillRect(b.position.x-c.size-(f+1)*e,b.position.y-c.size,e,2*c.size)}),new RunnerBehaviour(function(a,b,c){return new RunnerPosition(a.position.x,a.position.y+b.speed/c)},function(a,b){var c=Math.floor(a.width/b.size);Math.floor(a.height/b.size);return new RunnerPosition(b.size*GridRunnerUtil.random(0,c),-100)},function(a,b,c){return b.position.y>a.height+2*c.size+c.trailLength},function(a,b,c){a.fillStyle=b.colour.getRgb(),a.strokeStyle=b.colour.getRgb(),a.fillRect(b.position.x-c.size,b.position.y-c.size,2*c.size,2*c.size)},function(a,b,c){for(var d=100*c.initialTrailOpacity,e=c.trailLength/d,f=0;f<d;f++)a.fillStyle=b.colour.getRgba((d-f)/100),a.strokeStyle=b.colour.getRgba((d-f)/100),a.fillRect(b.position.x-c.size,b.position.y-c.size-(f+1)*e,2*c.size,e)})],Array.isArray(b)){var c=b.filter(function(a){return RunnerBehaviour.prototype.isPrototypeOf(a)});c.length!==b.length&&console.log("Error adding behaviours: Some behaviours have incorrect prototype."),this.behaviours=this.behaviours.concat(c)}else console.log("Error adding behaviours: Not an array.")}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.getRandomBehaviour=function(){return GridRunnerUtil.randomElement(this.behaviours)},MIXIN$0(a.prototype,b),b=void 0,a}(),Runner=function(){"use strict";function a(a,b,c){this.colour=a,this.behaviour=b,this.position=c}var b={},c={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.newRandomRunner=function(b,c,d,e){var f=d.getRandomColour(),g=e.getRandomBehaviour();return new a(f,g,g.getStartingPosition(b,c))},c.incrementPosition=function(a,b){this.position=this.behaviour.incrementPosition(this,a,b)},c.isFinished=function(a,b){return this.behaviour.isFinished(a,this,b)},c.draw=function(a,b){this.behaviour.draw(a,this,b)},c.drawTrail=function(a,b){this.behaviour.drawTrail(a,this,b)},MIXIN$0(a,b),MIXIN$0(a.prototype,c),b=c=void 0,a}(),RunnerSettings=function(){"use strict";function a(a,b,c,d,e,f,g){this.maxRunners=a,this.spawnChance=b,this.spawnDelay=c,this.size=d,this.speed=e,this.trailLength=f,this.initialTrailOpacity=g}return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),a}(),Stage=function(){"use strict";function a(a,b,c,d,e,f){this.canvas=a,this.context=a.getContext("2d"),this.refreshRate=b,this.runnerSettings=d,this.runnerColourManager=e,this.runnerBehaviourManager=f,this.runners=[],this.drawingIntervalId=null,this.spawningIntervalId=null,this.setContextSize(),this.setBgColour(c.r,c.g,c.b);var g=this;window.onresize=function(){g.setContextSize()}}var b={};return DP$0(a,"prototype",{configurable:!1,enumerable:!1,writable:!1}),b.startSpawning=function(){var a=this;this.spawningIntervalId=setInterval(function(){GridRunnerUtil.random(0,100)<a.runnerSettings.spawnChance&&a.runners.length<a.runnerSettings.maxRunners&&a.runners.push(Runner.newRandomRunner(a.context.canvas,a.runnerSettings,a.runnerColourManager,a.runnerBehaviourManager))},this.runnerSettings.spawnDelay)},b.stopSpawning=function(){null!==this.spawningIntervalId&&clearInterval(this.spawningIntervalId)},b.setBgColour=function(a,b,c){this.canvas.style.backgroundColor="rgb("+a+", "+b+", "+c+")"},b.setContextSize=function(){this.context.canvas.width=this.canvas.clientWidth,this.context.canvas.height=this.canvas.clientHeight},b.clear=function(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},b.startDrawing=function(){var a=this;this.drawingIntervalId=setInterval(function(){a.clear();for(var b=a.runners.length-1;b>=0;b--){var c=a.runners[b];c.incrementPosition(a.runnerSettings,a.refreshRate),c.isFinished(a.context.canvas,a.runnerSettings)&&a.runners.splice(b,1)}for(var d=a.runners.length-1;d>0;d--){var e=a.runners[d];e.drawTrail(a.context,a.runnerSettings)}for(var f=a.runners.length-1;f>0;f--){var g=a.runners[f];g.draw(a.context,a.runnerSettings)}},1e3/this.refreshRate)},b.stopDrawing=function(){null!==this.drawingIntervalId&&clearInterval(this.drawingIntervalId)},b.start=function(){this.startDrawing(),this.startSpawning()},b.pause=function(){this.stopDrawing(),this.stopSpawning()},b.stop=function(){this.pause(),this.clear(),this.runners=[]},MIXIN$0(a.prototype,b),b=void 0,a}();